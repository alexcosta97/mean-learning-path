# Introduction to MongoDB

## Introduction to NoSQL
In a common relational database, data is stored in different tables, often connected using a primary to foreign key relation. The application would then have to reconstruct the model using various SQL statements to arrange the data in some kind of hierarchical objetc representation.

Document-oriented databases handle data differently. Instead of using tables, they store hierarchical documents in standard formats, such as JSON and XML.

Whilst working with relational databases, the data is stored in different tables, with the applicaiton assembling objects using table records. Storing data as holistic documents will allow faster read operations since the application won't have to rebuild the objects with every read.

Document-based databases are often schemaless, which means that we can store different objects in a single collection of objects without changing anything in our database.

## Key features of MongoDB
Most of its key features were created to evolve beyond the limitations of other NoSQL solutions while inteegrating some of the abilities of relational databases.

## The BSON format
One of the greatest features of Mongo is its storing format: BSON. BAON stands for Binary JSON, and is a binary-encoded serialization of JSON-like documents, designed to be more efficient in size and speed.

Like JSON, BSON documents are a simple data structure representation of objects and array in a key-value format.

A document consists of a list of elements, each with a string types filed name and types filed value. These documents support all of the JSON specific data types along with other data types, such as the Date type.

Another big advantage of the BSON format is the use of the `_id` field value as primary key. The `_id` filed value usually will be a unique identifier type, name `ObjectId` that is either generated by the application driver or by the `mongod` service. In the event the driver fails to provide a id filed, the service will add it automatically using:

* A 4-byte value representing the seconds since the Unix epoch
* A 3-byte machine identifier
* A 2-byte process ID
* A 3-byte counter, starting with a random value

The BSON format enables MongoDB to internally index and map document properties and even nested documents, allowing it to scan the collection efficiently and more importantly, to match objects to complex query expressions.

## MongoDB ad hoc queries
Mongo supports ad hoc queries which means that the database will respond to dynamically structured queries out of the box without the need to predefine each query. It is able to do so by indexing BSON documents and using a unique query language.

For example, for the following SQL statement:
```sql
SELECT * FROM Posts WHERE Title LIKE '%mongo%';
```

This statement is asking the database for all the post records with a title containing the word `mongo`. Replicating this in MongoDB will be as follows:
`db.posts.find({title:/mongo/});`

Running this command in the MongoDB shell will return all the posts whose title field contains the word `mongo`.

## MongoDB indexing
Indexes are a unique data structure that enables the database engine to effieciently resolve queries. When a query is sent to the database, it will have to scan through the entire collection of documents to find those that match the query statement.

This way, the database engine processes a large amount of unnecessary data, resulting in poor performance.

To speed up the scan, the database engine can use a predefined index, which maps documents fields and can tell the engine which documents are compatible with this query statement.

For example, to retrieve from a posts database the posts that have more than 10 comments, MongoDB would have to go through all the posts and check whether the post has `commentCount` larger than 10. But if a `commentCount` index was defined, then Mongo would only have to check which documents have `commentCount` larger than 10, before retrieving the documents.

## MongoDB replica set
Mongo uses replication of databases to provide data redundancy and improved availability. Replication helps protect data to recover from hardware failure and increase read capacity. A replica set is a set of MongoDB services that host the same dataset.

In the replicate set, one service is the primary and the other are secondaties. All the instances support read operations, but only the primary instance is in charge of write operations. When a write operation occurs, the primary will inform the secondaries about the changes and make sure they've applied it to their datasets' replication.

Another feature of the replica set is its automatic failover. When one of the members can't reach the primary for more than 10 seconds, the replica set will automatically elect and promote a secondary instance as the new primary. When the old primary is back online, it rejoins the set as a secondary.

## MongoDB sharding

MongoDB supports horizontal scaling with what it refers to as sharding. Sharding is the process of splitting the data between different machines, known as shards. Each shard holds a portion of the data and functions as a separate database. The collections of several shards together is what forms a single logical database. Operations are performed through services called query routes, which ask the configuration servers how to delegate each operation to the right shard.

Next: [MongoDB shell](mongoShell.md)